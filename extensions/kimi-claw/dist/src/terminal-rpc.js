import{isPlainRecord as isRecord}from"./utils/json.js";import{asTrimmedNonEmptyString}from"./utils/text.js";export const TERMINAL_METHODS={open:"terminal/open",input:"terminal/input",resize:"terminal/resize",close:"terminal/close"};export const TERMINAL_UPDATE_METHOD="terminal/update";export const TERMINAL_ERROR_CODES={shellDisabled:-32010,terminalNotFound:-32011,terminalClosed:-32012,terminalQuotaExceeded:-32013,terminalTimeout:-32014};export const TERMINAL_INVALID_PARAMS={code:-32602,message:"invalid params"};const readString=(e,r)=>asTrimmedNonEmptyString(e[r]),readPositiveInteger=(e,r)=>{const t=e[r];if("number"==typeof t&&Number.isInteger(t)&&!(t<=0))return t},invalid=(e,r)=>({ok:!1,error:{...TERMINAL_INVALID_PARAMS,data:{field:e,reason:r}}}),parseBaseParams=e=>isRecord(e)?{ok:!0,value:e}:invalid("params","must be an object");export const parseTerminalOpenParams=e=>{const r=parseBaseParams(e);if(!r.ok)return r;const t=readString(r.value,"sessionId");if(!t)return invalid("sessionId","must be a non-empty string");const a=readPositiveInteger(r.value,"cols");if(!a)return invalid("cols","must be a positive integer");const n=readPositiveInteger(r.value,"rows");if(!n)return invalid("rows","must be a positive integer");const s=readString(r.value,"cwd");return{ok:!0,value:{sessionId:t,cols:a,rows:n,...s?{cwd:s}:{}}}};export const parseTerminalInputParams=e=>{const r=parseBaseParams(e);if(!r.ok)return r;const t=readString(r.value,"terminalId");if(!t)return invalid("terminalId","must be a non-empty string");const a=readString(r.value,"dataBase64");return a?{ok:!0,value:{terminalId:t,dataBase64:a}}:invalid("dataBase64","must be a non-empty string")};export const parseTerminalResizeParams=e=>{const r=parseBaseParams(e);if(!r.ok)return r;const t=readString(r.value,"terminalId");if(!t)return invalid("terminalId","must be a non-empty string");const a=readPositiveInteger(r.value,"cols");if(!a)return invalid("cols","must be a positive integer");const n=readPositiveInteger(r.value,"rows");return n?{ok:!0,value:{terminalId:t,cols:a,rows:n}}:invalid("rows","must be a positive integer")};export const parseTerminalCloseParams=e=>{const r=parseBaseParams(e);if(!r.ok)return r;const t=readString(r.value,"terminalId");return t?{ok:!0,value:{terminalId:t}}:invalid("terminalId","must be a non-empty string")};export const isTerminalRpcMethod=e=>Object.values(TERMINAL_METHODS).includes(e);